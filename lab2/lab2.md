# Лабораторная работа №2

## Цель:

1. Написать “плохой” Dockerfile, в котором есть не менее трех “bad practices” по написанию докерфайлов
2. Написать “хороший” Dockerfile, в котором эти плохие практики исправлены
3. В Readme описать каждую из плохих практик в плохом докерфайле, почему она плохая и как в хорошем она была исправлена, как исправление повлияло на результат
4. В Readme описать 2 плохих практики по работе с контейнерами. ! Не по написанию докерфайлов, а о том, как даже используя хороший докерфайл можно накосячить именно в работе с контейнерами.


## Ход работы

"плохой" Dockerfile:
```
FROM ubuntu:latest

RUN apt-get update

RUN apt-get install -y python3 
        
ADD . .

CMD ["python3", "app.py"]
```

"хороший" Dockerfile:
```
FROM python:3.14.0-slim

RUN apt-get update && apt-get install -y python3 

COPY . .

CMD ["python3", "app.py"]

```
## Отличия

1. Использование образа<br>
`FROM ubuntu:latest` - это плохо<br>
`FROM FROM python:3.14.0-slim` - это хорошо<br>
В первой строке "плохого" Dockerfile'а:<br>
* Нет смысла для питоновского скрипта использовать целый Ubuntu
* Нет указания конкретной версии - может привести к проблемам совместимости в будущем

2. RUN'ы<br>
`RUN apt-get update` <br>
`RUN apt-get install -y python3` - это плохо<br>
`RUN apt-get update && pip3 install pyyaml` - это хорошо<br>
Каждый RUN создает новый слой - это увеличивает образ.<br>

3. ADD и COPY<br>
`ADD . .` - это плохо<br>
`COPY . .` - это хорошо<br>
Лучше не использовать ADD, потому что COPY это чисто про копирование, а ADD может наделать лишнего (распаковать архивы какие-нибудь)

Итог: на 24 мб легче и на 0.9 секунды быстрее билдится

<img width="399" height="45" alt="image" src="https://github.com/user-attachments/assets/ebc2c34a-2c71-489f-8ea6-6141e65114c8" /> <br>
<img width="399" height="20" alt="image" src="https://github.com/user-attachments/assets/df4bbff5-a994-4b5d-b816-45380ec6230c" /> <br>
<img width="399" height="21" alt="image" src="https://github.com/user-attachments/assets/4d3699a7-8191-4094-9b1d-33510e28ba92" /> <br>

### Ошибки при работе с контейнерами

1. **Хранение данных только внутри контейнера** <br>
   Если все данные приложения сохраняются внутри контейнера, при его пересоздании или удалении данные будут потеряны. Это приводит к потере информации и сложностям с восстановлением. Правильная практика — использовать тома или внешние базы данных для постоянного хранения данных.

2. **Запуск контейнера с root-привилегиями без необходимости** <br>
   Даже если Dockerfile настроен корректно, запуск контейнера от root-пользователя повышает риск безопасности. Если контейнер будет скомпрометирован, злоумышленник получит доступ к хост-системе. Правильная практика — использовать непривилегированного пользователя внутри контейнера.


## Вывод

В ходе выполнения лабораторной работы я научился писать Dockerfile, оптимизировать слои Docker, сравнивать образы по размеру и слоям, выявлять bad practices в Dockerfile, строить образы и запускать контейнеры, минимизировать размер образа.
